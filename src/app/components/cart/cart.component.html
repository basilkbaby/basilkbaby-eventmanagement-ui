<div class="cart-container">
  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading your cart...</p>
  </div>

  <!-- Cart Content -->
  <div class="cart-content" *ngIf="!loading">
    <!-- Header -->
    <div class="cart-header">
      <h1>Your Cart</h1>
      <p *ngIf="cartItems.length === 0" class="empty-cart-message">Your cart is empty</p>
      <div class="cart-stats" *ngIf="cartItems.length > 0">
        <span>{{ cartSummary.itemCount }} {{ cartSummary.itemCount === 1 ? 'item' : 'items' }}</span>
      </div>
    </div>

    <!-- Cart Items -->
    <div class="cart-items" *ngIf="cartItems.length > 0">
      <!-- Clear Cart Button -->
      <div class="cart-actions">
        <button class="clear-cart-btn" (click)="clearCart()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2" 
                  stroke="currentColor" stroke-width="2"/>
          </svg>
          Clear All Items
        </button>
      </div>

      <!-- Event Group -->
      <div class="event-group" *ngFor="let event of getGroupedEvents()">
        <div class="event-header">
          <div class="event-title-container">
            <h2 class="event-title">{{ event.title }}</h2>
            <span class="event-item-count">{{ event.items.length }} {{ event.items.length === 1 ? 'ticket' : 'tickets' }}</span>
          </div>
          <div class="event-details">
            <div class="event-date">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="margin-right: 4px;">
                <path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" 
                      stroke="currentColor" stroke-width="2"/>
              </svg>
              {{ formatDate(event.date) }}
            </div>
            <div class="event-venue">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="margin-right: 4px;">
                <path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" 
                      stroke="currentColor" stroke-width="2"/>
                <path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" stroke="currentColor" stroke-width="2"/>
              </svg>
              {{ event.venue }}
            </div>
          </div>
        </div>

        <div class="items-list">
          <div *ngFor="let item of event.items; let i = index" class="cart-item" 
               [class.seat-item]="item.seat" [class.ticket-item]="item.ticketType">
            
            <!-- Item Type Badge -->
            <div class="item-type-badge">
              {{ getItemType(item) }}
            </div>

            <!-- Seat/Ticket Details -->
            <div class="item-details">
              <div class="item-info">
                <div class="seat-details" *ngIf="item.seat">
                  <div class="seat-row">
                    <span class="label">Section:</span>
                    <span class="value section-badge">{{ getSeatInfo(item).section }}</span>
                  </div>
                  <div class="seat-row">
                    <span class="label">Row:</span>
                    <span class="value">{{ getSeatInfo(item).row }}</span>
                  </div>
                  <div class="seat-row">
                    <span class="label">Seat:</span>
                    <span class="value">{{ getSeatInfo(item).seatNumber }}</span>
                  </div>
                </div>
                
                <div class="ticket-details" *ngIf="item.ticketType">
                  <div class="ticket-row">
                    <span class="label">Type:</span>
                    <span class="value">{{ item.ticketType.name || 'General Admission' }}</span>
                  </div>
                  <div class="ticket-row">
                    <span class="label">Quantity:</span>
                    <span class="value">{{ item.quantity }}</span>
                  </div>
                </div>
              </div>

              <!-- Quantity Controls - Only for ticket types, not seats -->
              <div class="item-controls" *ngIf="!item.seat && item.ticketType">
                <div class="quantity-controls">
                  <button class="quantity-btn minus" 
                          (click)="updateQuantity(item, -1)" 
                          [disabled]="item.quantity <= 1">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path d="M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                  </button>
                  <span class="quantity">{{ item.quantity }}</span>
                  <button class="quantity-btn plus" 
                          (click)="updateQuantity(item, 1)" 
                          [disabled]="item.quantity >= 10">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- Price and Actions -->
            <div class="item-price-section">
              <div class="item-price">
                {{ formatPrice(item.price * item.quantity) }}
                <span class="price-per-unit" *ngIf="item.quantity > 1">
                  ({{ formatPrice(item.price) }} each)
                </span>
              </div>
              
              <div class="item-actions">
                <button class="remove-btn" (click)="removeItem(item.id!)" title="Remove item">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                    <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  Remove
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Summary -->
    <div class="order-summary" *ngIf="cartItems.length > 0">
      <h3>Order Summary</h3>
      
      <div class="summary-line">
        <span>Subtotal</span>
        <span>{{ formatPrice(cartSummary.subtotal) }}</span>
      </div>
      
      <div class="summary-line">
        <span>Service Fee</span>
        <span>{{ formatPrice(cartSummary.serviceFee) }}</span>
      </div>
      
      <div class="summary-line total">
        <span>Total</span>
        <span>{{ formatPrice(cartSummary.total) }}</span>
      </div>

      <div class="checkout-actions">
        <button class="checkout-btn" (click)="proceedToCheckout()">
          Proceed to Checkout
        </button>
        <button class="continue-shopping-btn" (click)="continueShopping()">
          Continue Shopping
        </button>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="cartItems.length === 0 && !loading">
      <div class="empty-state-icon">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
          <path d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.3 2.3c-.4.4-.1 1.2.5 1.2H17m0 0v4a2 2 0 11-4 0v-4m-6 4a2 2 0 11-4 0 2 2 0 014 0z" 
                stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <h3>Your cart is empty</h3>
      <p>Find amazing events and add tickets to your cart</p>
      <button class="browse-events-btn" (click)="continueShopping()">
        Browse Events
      </button>
    </div>
  </div>
</div>