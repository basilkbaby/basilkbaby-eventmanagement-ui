<!-- event-list.component.html -->
<div class="event-list-container">
  <!-- Filters Section -->
  <section class="filters-section">
    <div class="filters-container">
      <!-- Search -->
      <div class="search-box">
        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" 
                stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <input 
          type="text" 
          class="search-input" 
          placeholder="Search events, artists, or venues..."
          [value]="searchTerm"
          (input)="onSearchInput($event)"
          aria-label="Search events"
        >
        <button 
          *ngIf="searchTerm" 
          class="clear-search" 
          (click)="resetSearch()"
          aria-label="Clear search"
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>

      <div class="filters-row">
        <!-- Date Filters -->
        <div class="date-filters">
          <div class="filter-buttons">
            <button 
              class="filter-btn" 
              [class.active]="dateFilter === 'upcoming'"
              (click)="filterByDate('upcoming')"
            >
              Upcoming
            </button>
            <button 
              class="filter-btn" 
              [class.active]="dateFilter === 'past'"
              (click)="filterByDate('past')"
            >
              Event Highlights
            </button>
            <button 
              class="filter-btn" 
              [class.active]="dateFilter === 'all'"
              (click)="filterByDate('all')"
            >
              All Events
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Loading State -->
  <section class="loading-section" *ngIf="isLoading">
    <div class="loading-container">
      <app-loading-spinner></app-loading-spinner>
      <p>Loading events...</p>
    </div>
  </section>

  <!-- Error State -->
  <section class="error-section" *ngIf="error && !isLoading">
    <div class="error-container">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
        <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" 
              stroke="currentColor" stroke-width="2"/>
        <path d="M12 8V12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M12 16H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <h3>Unable to load events</h3>
      <p>{{ error }}</p>
      <!-- Changed to emit event for parent to handle loading -->
      <button class="retry-btn" (click)="retryLoadEvents()">
        Try Again
      </button>
    </div>
  </section>

  <!-- Events Grid -->
  <section class="events-section" *ngIf="!isLoading && !error">
    <div class="events-container">
      <div class="events-grid" *ngIf="filteredEvents.length > 0">
        <div 
          *ngFor="let event of filteredEvents;" 
          class="event-card"
          [class.featured]="event.featured"
          [routerLink]="['/events', event.id]"
          tabindex="0"
          role="button"
          (keydown.enter)="$event.preventDefault()"
          (keydown.space)="$event.preventDefault()"
        >
          <!-- Featured Badge -->
          <div class="featured-badge" *ngIf="event.featured" aria-label="Featured event">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            Featured
          </div>

          <!-- Event Image -->
          <div class="event-image">
            <img 
              [src]="event.bannerImage" 
              [alt]="event.title" 
              loading="lazy"
              (error)="handleImageError($event)"
            />
            <div class="image-overlay"></div>
          </div>

          <!-- Event Content -->
          <div class="event-content">
            <div class="event-header">
              <div class="event-date">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                  <path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zm0-12H5V6h14v2z"/>
                </svg>
                <!-- Use pipe instead of method -->
                {{ event.startDate | formatDate }}
              </div>
            </div>
            
            <h3 class="event-title">{{ event.title }}</h3>
            <p class="event-description">{{ event.shortDescription }}</p>
            
            <div class="event-location">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
              </svg>
              {{ event.venueName }}, {{ event.venueCity }}
            </div>

            <div class="event-footer">
              <div class="event-pricing">
                <div class="price">
                  From {{ event.startingFromPrice }}
                </div>
              </div>
              <button 
                class="buy-btn" 
                (click)="$event.stopPropagation()" 
                [routerLink]="['/events', event.id]"
                [attr.aria-label]="'Get tickets for ' + event.title"
              >
                {{ (event.isPast || !event.isActive) ? 'Event Details' : 'Get Tickets' }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- No Results -->
      <div class="no-results" *ngIf="filteredEvents.length === 0 && !isLoading">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
          <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" 
                stroke="currentColor" stroke-width="2"/>
          <path d="M15 9L9 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M9 9L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <h3>No events found</h3>
        <p>Try adjusting your search or filter criteria</p>
        <button class="reset-filters" (click)="resetFilters()">
          Reset Filters
        </button>
      </div>
    </div>
  </section>
</div>