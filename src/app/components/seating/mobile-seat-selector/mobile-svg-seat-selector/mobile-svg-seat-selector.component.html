<div class="mobile-svg-seat-selector" *ngIf="!loading && section">
  <!-- Header -->
  <header class="mobile-header">
    <button class="back-btn" (click)="goBack()">
      <svg viewBox="0 0 24 24">
        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
      </svg>
    </button>
    <div class="header-title">
      <h2>{{ section.sectionLabel || section.name || 'Loading...' }}</h2>
      <p class="seat-stats">
        <span>{{ getAvailableSeatsCount() }}</span> seats • 
        <span>{{ formatPrice(getMinPrice()) }}+</span>
      </p>
    </div>
  </header>

  <!-- Error Message -->
  <div class="mobile-error" *ngIf="selectionError">
    <svg viewBox="0 0 24 24">
      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
    </svg>
    <span>{{ selectionError }}</span>
  </div>

  <!-- Main Content Area -->
  <div class="content-wrapper" *ngIf="seats.length > 0">
    <!-- SVG Container -->
    <div class="svg-pan-container">
      <svg #seatMapSvg class="seat-map-svg">
        
        <!-- Stage -->
        <g class="stage">
          <rect class="stage-rect" x="100" y="20" width="800" height="60" rx="10" ry="10" [attr.rx]="8" 
                stroke="#bebebe" 
                 fill="#ffffff" 
                [attr.stroke-width]="2" />
          <text class="stage-text" x="500" y="50"  text-anchor="middle" 
                font-family="Arial"
                [attr.font-size]="18" 
                font-weight="bold" 
                fill="#bebebe">STAGE</text>
        </g>
        
        <!-- Row Labels -->
        <g class="row-labels">
          <text *ngFor="let label of rowLabels"
                class="row-label"
                [attr.x]="label.x"
                [attr.y]="label.y"
                [attr.text-anchor]="label.side === 'left' ? 'end' : 'start'"
                dominant-baseline="middle">
            {{ label.label }}
          </text>
        </g>

        <!-- Seats - Using Seat model directly -->
        <g class="seats-container">
          <g *ngFor="let seat of seats; trackBy: trackBySeatId"
             class="seat-wrapper"
             [attr.transform]="'translate(' + seat.cx + ',' + seat.cy + ')'">
            
            <!-- Regular seats as circles -->
            <circle *ngIf="!seat.isStandingArea"
                    class="seat-circle"
                    [attr.r]="seat.r"
                    [class]="getSeatStatusClass(seat)"
                    [attr.fill]="getSeatFillColor(seat)"
                    [attr.stroke]="getSeatStrokeColor(seat)"
                    (click)="toggleSeat(seat)">
            </circle>
            
            <!-- Standing tickets as rectangles -->
             <!-- Standing tickets as rectangles with text -->
    <g *ngIf="seat.isStandingArea" (click)="toggleSeat(seat)" class="standing-group">
      <rect class="standing-rect"
            [attr.x]="-seat.r * 1.5" 
            [attr.y]="-seat.r"
            [attr.width]="seat.r * 3"
            [attr.height]="seat.r * 2"
            [attr.rx]="8"
            [class]="getSeatStatusClass(seat)"
            [attr.fill]="getSeatFillColor(seat)"
            [attr.stroke]="getSeatStrokeColor(seat)">
      </rect>
      
      <!-- Text on standing rectangle -->
      <text class="standing-text"
            x="0"
            y="0"
            text-anchor="middle"
            dominant-baseline="middle"
            font-family="Arial"
            font-size="11"
            font-weight="bold"
            fill="white">
        STANDING
      </text>
      
      <!-- Additional instruction text -->
      <text class="standing-instruction"
            x="0"
            y="15"
            text-anchor="middle"
            dominant-baseline="middle"
            font-family="Arial"
            font-size="9"
            fill="white">
        Click to select
      </text>
    </g>
            
          </g>
        </g>

      </svg>
      
      <!-- Legend - Inside SVG container -->
      <div class="mobile-legend" *ngIf="seats.length > 0">
        <!-- Section colors -->
        <div class="legend-item" *ngFor="let block of getUniqueBlocks()">
          <div class="legend-color" 
               [style.background]="getBlockColor(block)" 
               [style.border-color]="getBlockStroke(block)"></div>
          <span>{{ block }}</span>
        </div>
        <!-- Status colors -->
        <div class="legend-item" *ngFor="let item of legendItems">
          <div class="legend-color" 
               [style.background]="item.color" 
               [style.border-color]="item.stroke"></div>
          <span>{{ item.label }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- No Seats Message -->
  <div class="no-seats-message" *ngIf="!loading && seats.length === 0">
    <div class="message-content">
      <svg viewBox="0 0 24 24">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
      </svg>
      <h3>No Seats Available</h3>
      <p>There are no seats to display for this section.</p>
    </div>
  </div>

  <!-- Selection Summary (Updated to match web) -->
  <div class="mobile-summary" [class.visible]="summaryVisible" *ngIf="selectedSeats.length > 0">
    <div class="summary-header">
      <h3>Selected Seats ({{ selectedSeats.length }})</h3>
      <button class="clear-btn" (click)="clearSelection()">Clear All</button>
    </div>
  
    <!-- Seat chips for more seats -->
    <div class="seats-grid">
      <div class="seat-tag" *ngFor="let seat of selectedSeats">
        <span class="seat-label" *ngIf="!seat.isStandingArea">
          {{ seat.seatId }}
        </span>
        
        <!-- Standing ticket display -->
        <div class="standing-ticket-display" *ngIf="seat.isStandingArea">
          <div class="standing-ticket-info">
            <span class="seat-label">{{ seat.seatId }}</span>
            <span class="standing-note">(Standing - No specific seat)</span>
          </div>
          <button class="remove-tag" (click)="removeSingleSeat(seat)" title="Remove">×</button>
        </div>
      </div>
    </div>

    <!-- Standing ticket message and ADD MORE button -->
    <div class="standing-info-section" *ngIf="hasStandingTickets()">
      <div class="standing-message">
        <span class="info-icon">ℹ️</span>
        <span>Standing tickets are for general admission areas and don't have specific seats.</span>
      </div>
      
      <!-- ADD MORE BUTTON -->
      <button class="add-more-standing-btn" (click)="addAnotherStandingTicket()">
        + Add Another Standing Ticket
      </button>
    </div>

    <div class="quick-summary">
      <div class="price-breakdown">
        <div class="price-item" *ngFor="let seat of selectedSeats">
          <span>
            <span *ngIf="!seat.isStandingArea">
              {{ seat.seatId }}
            </span>
            <span *ngIf="seat.isStandingArea">
              {{ seat.seatId }} (Standing)
            </span>
          </span>
          <span>{{ formatPrice(seat.price) }}</span>
        </div>
      </div>
      <div class="total-price">
        <span>Total:</span>
        <span class="amount">{{ formatPrice(getTotalPrice()) }}</span>
      </div>
    </div>
    
    <div class="action-buttons-compact">
      <button class="btn-add-compact" (click)="addToCart()" [disabled]="isLoading || selectedSeats.length === 0"
        [class.loading]="isLoading">

        <!-- Default content -->
        <span class="default-content" *ngIf="!isLoading">
          Add {{ selectedSeats.length }} to Cart
        </span>

        <!-- Loading content -->
        <span class="loading-content" *ngIf="isLoading">
          <span class="spinner"></span>
          Adding...
        </span>
      </button>

    </div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-state" *ngIf="loading">
  <div class="loading-content">
    <div class="spinner"></div>
    <p>Loading seat map...</p>
  </div>
</div>