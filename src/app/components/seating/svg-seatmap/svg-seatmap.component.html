<div class="seat-selection-layout" *ngIf="!loading">

  <!-- Main Canvas Area -->
 <main class="canvas-area">
    <div class="canvas-wrapper">
      <!-- SVG Component -->
      <app-seat-map-visual
        [venueData]="venueData"
        [seats]="seats"
        [selectedSeatIds]="selectedSeatIds"
        [hoveredSeatId]="hoveredSeatId"
        [scale]="scale"
        [offsetX]="offsetX"
        [offsetY]="offsetY"
        [rowLabels]="rowLabels"
        (seatClicked)="onSeatClicked($event)"
        (seatHovered)="onSeatHovered($event)"
        (dragStarted)="onDragStarted($event)"
        (dragMoved)="onDragMoved($event)"
        (dragEnded)="onDragEnded()"
        (zoomed)="onZoomed($event)"
        class="seat-map-visual">
      </app-seat-map-visual>
    </div>
  </main>

  <!-- Sidebar / Mobile Bottom Sheet -->
  <aside class="controls-sidebar expanded">
    
    <!-- Desktop Header -->
    <div class="compact-header">
      
      <div class="event-info-ultra-compact">
        <h1>{{ venueData.eventName }}</h1>
        <div class="event-details-minimal">
          <span class="detail-item">
            {{ venueData.eventDate | formatDate }}
          </span>
        </div>
      </div>
    </div>
    

    <!-- Selected Seats Summary -->
    <div class="selected-summary" 
         *ngIf="(selectedSeats.length > 0)">
      
      <div class="summary-header">
        <h3>Selected Seats ({{ selectedSeats.length }})</h3>
        <button class="clear-btn" (click)="clearSelection()">Clear All</button>
      </div>
      
      <div class="seats-grid">
        <div class="seat-tag" *ngFor="let seat of selectedSeats; let i = index">
          <span class="seat-label" *ngIf="!seat.isStandingArea">
            {{ seat.id }}
          </span>
          <span class="seat-label" *ngIf="seat.isStandingArea">
            Standing Area
          </span>
          <button class="remove-tag" 
                  (click)="onRemoveSeat(seat.id, $event)" 
                  title="Remove">Ã—</button>
        </div>
      </div>
      
      <div class="quick-summary">
        <div class="price-breakdown">
          <div class="price-item" *ngFor="let seat of selectedSeats">
            <span>
              <span *ngIf="!seat.isStandingArea">
                {{ seat.id }}
              </span>
              <span *ngIf="seat.isStandingArea">
                {{ seat.id }} Standing
              </span>
            </span>
            <span>{{ formatPrice(seat.price) }}</span>
          </div>
        </div>
        <div class="total-price">
          <span>Total:</span>
          <span class="amount">{{ formatPrice(getTotalPrice()) }}</span>
        </div>
      </div>
      
      <div class="action-buttons-compact">
        <button class="btn-add-compact" (click)="addToCart()">
          Add {{ selectedSeats.length }} to Cart
        </button>
        <button class="btn-view-cart-compact" [routerLink]="['/cart']">
          View Cart
        </button>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state-compact" *ngIf="selectedSeats.length === 0">
      <div class="empty-icon">ðŸ‘†</div>
      <p>Click on seats to select them</p>
      <p class="hint" *ngIf="getUniqueTicketTiers().length > 0">
        Available seats are shown in 
        <span *ngFor="let tier of getUniqueTicketTiers(); let last = last">
          <span [style.color]="tier.color">{{ tier.name.toLowerCase() }}</span>
          <span *ngIf="!last">, </span>
        </span>
      </p>
    </div>

    <!-- Legend -->
    <div class="compact-legend">
      <h4>Seat Types</h4>
      
      <!-- Ticket Tiers -->
      <div class="legend-container">
        <div class="legend-item-compact" *ngFor="let tier of getUniqueTicketTiers()">
          <div class="legend-color-compact" [style.background-color]="tier.color"></div>
          <span class="legend-label-compact">{{ tier.name }}</span>
          <span class="legend-price-compact">{{ formatPrice(tier.price) }}</span>
        </div>
      </div>
      
      <!-- Seat Status -->
      <div class="legend-container">
        <div class="legend-item-compact" *ngFor="let status of getDisplayStatuses()">
          <div class="legend-color-compact" 
               [style.background-color]="seatStatusConfig[status.status].color"
               [style.border]="status.status === SeatStatus.PARTIAL_VIEW ? '1px solid #999' : 'none'">
            <div *ngIf="status.status === SeatStatus.PARTIAL_VIEW" class="partial-view-compact">
              <div class="half-left" [style.background-color]="seatStatusConfig[SeatStatus.AVAILABLE].color"></div>
              <div class="half-right" [style.background-color]="seatStatusConfig[SeatStatus.UNAVAILABLE].color"></div>
            </div>
          </div>
          <span class="legend-label-compact">{{ status.displayText }}</span>
          <span class="legend-price-compact">{{ status.price }}</span>
        </div>
      </div>
    </div>

    <!-- Desktop Zoom Controls -->
    <div class="zoom-controls-compact" >
      <h4>Controls</h4>
      <div class="zoom-buttons-compact">
        <button (click)="zoomIn()" title="Zoom In">
          <span class="zoom-icon">+</span>
          <span>Zoom In</span>
        </button>
        <button (click)="zoomOut()" title="Zoom Out">
          <span class="zoom-icon">âˆ’</span>
          <span>Zoom Out</span>
        </button>
        <button (click)="resetView()" title="Reset View">
          <span class="zoom-icon">â†º</span>
          <span>Reset</span>
        </button>
      </div>
    </div>
    
  </aside>
</div>