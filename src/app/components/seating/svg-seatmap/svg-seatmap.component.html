<div class="seat-selection-layout">

  <!-- Main Canvas Area -->
  <main class="canvas-area">
    <div class="canvas-wrapper">
      <!-- SVG Container -->
      <div class="svg-container" #svgContainer (mousedown)="startDrag($event)"
     (mousemove)="doDrag($event)"
     (mouseup)="stopDrag()"
     (mouseleave)="stopDrag()"
     style="cursor: grab;">
        <svg #svgElement
             class="seatmap-svg"
             [attr.viewBox]="'0 0 ' + CANVAS_WIDTH + ' ' + CANVAS_HEIGHT"
             preserveAspectRatio="xMidYMid meet"
              [style.transform]="'scale(' + scale + ')'"
(wheel)="onZoom($event)"
             >
          
          <!-- Stage -->
          <rect [attr.x]="(CANVAS_WIDTH - STAGE_WIDTH) / 2"
                [attr.y]="STAGE_Y"
                [attr.width]="STAGE_WIDTH"
                [attr.height]="STAGE_HEIGHT"
                [attr.rx]="8"
                fill="#ffffff"
                stroke="#bebebe"
                [attr.stroke-width]="2" />
          
          <text [attr.x]="CANVAS_WIDTH / 2"
                [attr.y]="STAGE_Y + STAGE_HEIGHT / 2 + 6"
                text-anchor="middle"
                font-family="Arial"
                [attr.font-size]="stageFontSize"
                font-weight="bold"
                fill="#bebebe">STAGE</text>
          
          <!-- Section Labels -->
          <g *ngFor="let section of venueData.sections; let i = index">
              <text [attr.x]="section.x + (section.seatsPerRow * seatGap / 2)"
                    [attr.y]="section.y - 20"
                    text-anchor="center"
                    font-family="Arial"
                    font-size="16"
                    font-weight="bold"
                    fill="#bebebe">
                {{ section.sectionLabel || section.name }}
              </text>
          </g>
          
          <!-- Row Labels -->
          <ng-container *ngIf="venueData.sections.length > 0">
            <g *ngFor="let row of getRowArray(venueData.sections[0].rows); let i = index">
              <text [attr.x]="venueData.sections[0].x - 20"
                    [attr.y]="venueData.sections[0].y + (i * seatGap) + (venueData.sections[0].rowOffset || 0) + 4"
                    font-family="Arial"
                    font-size="12"
                    font-weight="bold"
                    fill="#333">
                {{ getRowLetter(i) }}
              </text>
            </g>
          </ng-container>

          
          <!-- Seats -->
          <g *ngFor="let seat of seats">
            <!-- Regular seats -->
            <circle *ngIf="seat.status !== SeatStatus.PARTIAL_VIEW"
                    [attr.cx]="seat.cx"
                    [attr.cy]="seat.cy"
                    [attr.r]="seatRadius"
                    [attr.fill]="getSeatColor(seat)"
                    [attr.stroke]="getSeatStroke(seat)"
                    [attr.stroke-width]="getSeatStrokeWidth(seat)"
                    [attr.opacity]="getSeatOpacity(seat)"
                    [attr.cursor]="getSeatCursor(seat)"
                    (click)="onSeatClick(seat, $event)">
              
              <title>
                {{ seat.section }} - {{ seat.rowLabel }}{{ seat.seatNumber }}
                {{ seat.status !== SeatStatus.AVAILABLE ? '(' + getSeatStatusText(seat.status, seat.ticketType) + ')' : '' }}
              </title>
            </circle>
            
            <!-- Partial view seats -->
            <g *ngIf="seat.status === SeatStatus.PARTIAL_VIEW">
              <defs>
                <linearGradient [attr.id]="'partial-' + seat.id" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" [style.stop-color]="seat.color"></stop>
                  <stop offset="50%" [style.stop-color]="seat.color"></stop>
                  <stop offset="50%" [style.stop-color]="seatStatusConfig[SeatStatus.UNAVAILABLE].color"></stop>
                  <stop offset="100%" [style.stop-color]="seatStatusConfig[SeatStatus.UNAVAILABLE].color"></stop>
                </linearGradient>
              </defs>
              
              <circle [attr.cx]="seat.cx"
                      [attr.cy]="seat.cy"
                      [attr.r]="seatRadius"
                      [attr.fill]="'url(#partial-' + seat.id + ')'"
                      [attr.stroke]="getSeatStroke(seat)"
                      [attr.stroke-width]="getSeatStrokeWidth(seat)"
                      [attr.opacity]="getSeatOpacity(seat)"
                      [attr.cursor]="getSeatCursor(seat)"
                      (click)="onSeatClick(seat, $event)">
                
                <title>
                  {{ seat.section }} - {{ seat.rowLabel }}{{ seat.seatNumber }}
                  ({{ getSeatStatusText(seat.status, seat.ticketType) }})
                  - Partial/obstructed view
                </title>
              </circle>
            </g>
            
            <!-- Selected indicator -->
            <g *ngIf="seat.status === SeatStatus.SELECTED">
              <circle [attr.cx]="seat.cx"
                      [attr.cy]="seat.cy"
                      [attr.r]="seatRadius * 1.2"
                      fill="#4CAF50"
                      [attr.opacity]="0.8" />
              
              <text [attr.x]="seat.cx"
                    [attr.y]="seat.cy"
                    text-anchor="middle"
                    dominant-baseline="middle"
                    fill="white"
                    font-weight="bold"
                    [attr.font-size]="'12'">âœ“</text>
            </g>
            
            <!-- Status indicator for unavailable seats -->
            <text *ngIf="seat.status === SeatStatus.SOLD || seat.status === SeatStatus.RESERVED || seat.status === SeatStatus.BLOCKED"
                  [attr.x]="seat.cx"
                  [attr.y]="seat.cy"
                  text-anchor="middle"
                  dominant-baseline="middle"
                  fill="white"
                  [attr.font-size]="'10'"
                  font-weight="bold">
              {{ seat.status === SeatStatus.SOLD ? 'S' : 
                 seat.status === SeatStatus.RESERVED ? 'R' : 
                 seat.status === SeatStatus.BLOCKED ? 'X' : '' }}
            </text>
          </g>    
        </svg>
      </div>
    </div>
  </main>

  <!-- Sidebar / Mobile Bottom Sheet -->
  <aside class="controls-sidebar expanded">
    
    <!-- Desktop Header -->
    <div class="compact-header">
      
      <div class="event-info-ultra-compact">
        <h1>{{ event.title }}</h1>
        <div class="event-details-minimal">
          <span class="detail-item">
            {{ formatDate(event.date) }}
          </span>
          <span class="detail-item">
            {{ event.time }}
          </span>
          <span class="detail-item">
            {{ event.venue }}
          </span>
        </div>
      </div>
    </div>
    


    <!-- Selected Seats Summary -->
    <div class="selected-summary" 
         *ngIf="(selectedSeats.length > 0)">
      
      <div class="summary-header">
        <h3>Selected Seats ({{ selectedSeats.length }})</h3>
        <button class="clear-btn" (click)="clearSelection()">Clear All</button>
      </div>
      
      <div class="seats-grid">
        <div class="seat-tag" *ngFor="let seat of selectedSeats; let i = index">
          <span class="seat-label">{{ seat.row }}S{{ seat.number }}</span>
          <span class="seat-tier" [style.color]="seat.tier.color">
            {{ seat.tier.name.charAt(0) }}
          </span>
          <button class="remove-tag" 
                  (click)="onRemoveSeat(seat.id, $event)" 
                  title="Remove">Ã—</button>
        </div>
      </div>
      
      <div class="quick-summary">
        <div class="price-breakdown">
          <div class="price-item" *ngFor="let seat of selectedSeats">
            <span>{{ seat.tier.name }} {{ seat.row }}{{ seat.number }}</span>
            <span>{{ formatPrice(seat.price) }}</span>
          </div>
        </div>
        <div class="total-price">
          <span>Total:</span>
          <span class="amount">{{ formatPrice(getTotalPrice()) }}</span>
        </div>
      </div>
      
      <div class="action-buttons-compact">
        <button class="btn-add-compact" (click)="addToCart()">
          Add {{ selectedSeats.length }} to Cart
        </button>
        <button class="btn-view-cart-compact" [routerLink]="['/cart']">
          View Cart
        </button>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state-compact" *ngIf="selectedSeats.length === 0">
      <div class="empty-icon">ðŸ‘†</div>
      <p>Click on seats to select them</p>
      <p class="hint" *ngIf="getUniqueTicketTiers().length > 0">
        Available seats are shown in 
        <span *ngFor="let tier of getUniqueTicketTiers(); let last = last">
          <span [style.color]="tier.color">{{ tier.name.toLowerCase() }}</span>
          <span *ngIf="!last">, </span>
        </span>
      </p>
    </div>

    <!-- Legend -->
    <div class="compact-legend">
      <h4>Seat Types</h4>
      
      <div class="legend-items-compact">
        <!-- Ticket type tiers -->
        <div class="legend-item-compact" *ngFor="let tier of getUniqueTicketTiers()">
          <div class="legend-color-compact" [style.background-color]="tier.color"></div>
          <span class="legend-label-compact">{{ tier.name }}</span>
          <span class="legend-price-compact">{{ formatPrice(tier.price) }}</span>
        </div>
        
        <!-- Seat status types -->
        <div class="legend-item-compact" *ngFor="let status of getDisplayStatuses()">
          <div class="legend-color-compact" 
               [style.background-color]="seatStatusConfig[status.status].color"
               [style.border]="status.status === SeatStatus.PARTIAL_VIEW ? '1px solid #999' : 'none'">
            <div *ngIf="status.status === SeatStatus.PARTIAL_VIEW" class="partial-view-compact">
              <div class="half-left" [style.background-color]="seatStatusConfig[SeatStatus.AVAILABLE].color"></div>
              <div class="half-right" [style.background-color]="seatStatusConfig[SeatStatus.UNAVAILABLE].color"></div>
            </div>
          </div>
          <span class="legend-label-compact">{{ status.displayText }}</span>
          <span class="legend-price-compact">{{ status.price }}</span>
        </div>
      </div>
    </div>

    <!-- Desktop Zoom Controls -->
    <div class="zoom-controls-compact" >
      <h4>Controls</h4>
      <div class="zoom-buttons-compact">
        <button (click)="zoomAt(1.2, CANVAS_WIDTH/2, CANVAS_HEIGHT/2)" title="Zoom In">
          <span class="zoom-icon">+</span>
          <span>Zoom In</span>
        </button>
        <button (click)="zoomAt(0.8, CANVAS_WIDTH/2, CANVAS_HEIGHT/2)" title="Zoom Out">
          <span class="zoom-icon">âˆ’</span>
          <span>Zoom Out</span>
        </button>
        <button (click)="resetView()" title="Reset View">
          <span class="zoom-icon">â†º</span>
          <span>Reset</span>
        </button>
      </div>
    </div>
    
  </aside>
<!-- Desktop Tooltip -->
<div class="svg-tooltip desktop-tooltip" 
     *ngIf="hoveredSeat && shouldShowTooltip()"
     [style.left.px]="tooltipLeft"
     [style.top.px]="tooltipTop">
  <div class="tooltip-content" *ngIf="hoveredSeat">
    <h4>{{ hoveredSeat.section }} {{ formatPrice(hoveredSeat.price) }}</h4>
    <p>{{ hoveredSeat.rowLabel }}{{ hoveredSeat.seatNumber }}, 
       {{ getSeatStatusText(hoveredSeat.status, hoveredSeat.ticketType) }}</p>
    
    <div *ngIf="hoveredSeat.features && hoveredSeat.features.length" class="tooltip-features">
      <div *ngFor="let feature of hoveredSeat.features" class="feature">
        â€¢ {{ feature }}
      </div>
    </div>
    

  </div>
  <div class="tooltip-arrow"></div>
</div>
</div>