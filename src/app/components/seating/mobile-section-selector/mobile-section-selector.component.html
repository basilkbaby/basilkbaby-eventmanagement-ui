<div class="mobile-section-selector" *ngIf="!loading">

  <!-- Simple Header -->
  <div class="simple-header">
    <h1>Select Section</h1>
    <p class="instructions">Pinch to zoom • Drag to pan • Tap a section</p>
  </div>

  <!-- Zoom Controls -->
  <div class="zoom-controls">
    <button class="zoom-btn" (click)="zoomIn()">+</button>
    <button class="zoom-btn" (click)="resetView()">↺</button>
    <button class="zoom-btn" (click)="zoomOut()">−</button>
  </div>

  <!-- SVG Container -->
  <div class="svg-container" #svgContainer>
    <div class="svg-wrapper" 
      [style.transform]="'scale(' + scale + ')'" 
      [style.left.px]="offsetX"
      [style.top.px]="offsetY">

      <svg class="venue-svg" 
        [attr.width]="CANVAS_WIDTH" 
        [attr.height]="CANVAS_HEIGHT">

        <!-- Stage -->
        <rect 
          [attr.x]="(CANVAS_WIDTH - STAGE_WIDTH) / 2" 
          [attr.y]="10" 
          [attr.width]="STAGE_WIDTH"
          [attr.height]="STAGE_HEIGHT" 
          rx="10" 
          fill="#ffffff" 
          stroke="#764ba2" 
          stroke-width="3" />

        <text 
          [attr.x]="CANVAS_WIDTH / 2" 
          [attr.y]="10 + STAGE_HEIGHT / 2 + 8" 
          text-anchor="middle" 
          font-family="Arial"
          font-size="24" 
          font-weight="bold" 
          fill="#764ba2">
          STAGE
        </text>

        <!-- Section Blocks -->
        <g *ngFor="let section of venueData.sections">
          <!-- Group for the entire section -->
          <g class="section-group" (click)="onSectionClick(section)">

            <!-- Background -->
            <rect 
              [attr.x]="section.mx" 
              [attr.y]="section.my + (section.rowOffset || 0)"
              [attr.width]="getSectionWidth(section)" 
              [attr.height]="getSectionHeight(section)" 
              fill="#f8f9fa"
              stroke="#dee2e6" 
              stroke-width="1" 
              rx="6" />

            <!-- Row config visualization with text labels -->
            <g *ngFor="let rowConfig of getRowConfigVisual(section)">
              <rect 
                [attr.x]="section.mx" 
                [attr.y]="section.my + (section.rowOffset || 0) + rowConfig.startY"
                [attr.width]="getSectionWidth(section)" 
                [attr.height]="rowConfig.height" 
                [attr.fill]="rowConfig.color"
                [attr.opacity]="selectedSection === section ? 1 : 0.9" 
                stroke="#ffffff" 
                stroke-width="1" 
                rx="4"
                class="section-block" 
                [class.selected]="selectedSection === section">
              </rect>

              <!-- Type name -->
<!-- Add this to calculate width once -->
<ng-container *ngIf="getSectionWidth(section) as sectionWidth">
  
  <!-- For width > 200 - Single line -->
  <text 
    *ngIf="sectionWidth > 200"
    [attr.x]="section.mx + sectionWidth / 2"
    [attr.y]="section.my + (section.rowOffset || 0) + rowConfig.startY + rowConfig.height / 2 - 8"
    text-anchor="middle" 
    font-family="Arial, sans-serif" 
    font-size="30" 
    font-weight="bold" 
    fill="#ffffff"
    style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
    {{ section.seatSectionType == SeatSectionType.STANDING ? "Standing" : rowConfig.ticketType}} - {{ (rowConfig.price) | currencyFormat:'GBP':'en-GB':0 }}
  </text>

  <!-- For width between 100 and 200 - Two lines -->
  <g *ngIf="sectionWidth >= 100 && sectionWidth <= 200">
    <!-- First line: Section name -->
    <text 
      [attr.x]="section.mx + sectionWidth / 2"
      [attr.y]="section.my + (section.rowOffset || 0) + rowConfig.startY + rowConfig.height / 2 - 15"
      text-anchor="middle" 
      font-family="Arial, sans-serif" 
      font-size="25" 
      font-weight="bold" 
      fill="#ffffff"
      style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
      {{ section.seatSectionType == SeatSectionType.STANDING ? "Standing" : rowConfig.ticketType}}
    </text>
    <!-- Second line: Price -->
    <text 
      [attr.x]="section.mx + sectionWidth / 2"
      [attr.y]="section.my + (section.rowOffset || 0) + rowConfig.startY + rowConfig.height / 2 + 15"
      text-anchor="middle" 
      font-family="Arial, sans-serif" 
      font-size="25" 
      font-weight="bold" 
      fill="#ffffff"
      style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
      {{ (rowConfig.price) | currencyFormat:'GBP':'en-GB':0 }}
    </text>
  </g>

  <!-- For width < 100 - Vertical text -->
  <g *ngIf="sectionWidth < 100">
  <!-- Section name vertical -->
  <text 
    [attr.x]="section.mx + sectionWidth / 2"
    [attr.y]="section.my + (section.rowOffset || 0) + rowConfig.startY + rowConfig.height / 2"
    text-anchor="middle" 
    font-family="Arial, sans-serif" 
    font-size="30" 
    font-weight="bold" 
    fill="#ffffff"
    style="writing-mode: vertical-lr; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
    {{ section.seatSectionType == SeatSectionType.STANDING ? "Standing" : rowConfig.ticketType}}
  </text>
  
  <!-- Price further below -->
  <text 
    [attr.x]="section.mx + sectionWidth / 2"
    [attr.y]="section.my + (section.rowOffset || 0) + rowConfig.startY + rowConfig.height / 2 + 100" 
    text-anchor="middle" 
    font-family="Arial, sans-serif" 
    font-size="30" 
    font-weight="bold" 
    fill="#ffffff"
    style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
    {{ (rowConfig.price) | currencyFormat:'GBP':'en-GB':0 }}
  </text>
</g>

</ng-container>

                <!-- Price (only if > 0) -->
                <!-- <text *ngIf="rowConfig.price > 0" 
                  [attr.x]="section.mx + getSectionWidth(section) / 2"
                  [attr.y]="section.my + (section.rowOffset || 0) + rowConfig.startY + rowConfig.height / 2 + 50"
                  text-anchor="middle" 
                  font-family="Arial, sans-serif" 
                  font-size="30" 
                  font-weight="600" 
                  fill="#ffffff"
                  style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
                  {{ (rowConfig.price) | currencyFormat }}
                </text> -->
            </g>


            <!-- Selected section highlight -->
            <rect *ngIf="selectedSection === section" [attr.x]="section.mx - 6"
              [attr.y]="section.my + (section.rowOffset || 0) - 6" [attr.width]="getSectionWidth(section) + 12"
              [attr.height]="getSectionHeight(section) + 12" fill="none" stroke="#4CAF50" stroke-width="4" rx="10"
              stroke-dasharray="8,4" />
          </g>
        </g>


      </svg>
    </div>
  </div>

  <!-- Selected Section Info -->
  <div class="selected-info" *ngIf="selectedSection">
    <div class="info-content">
      <div class="section-header">
        <h3>{{ selectedSection.sectionLabel || selectedSection.name }}</h3>
        <div class="section-meta">
          <span class="meta-item">
            {{ selectedSection.rows }} rows
          </span>
          <span class="meta-item">
            {{ selectedSection.seatsPerRow }} seats/row
          </span>
          <span class="meta-item">
            {{ selectedSection.rows * selectedSection.seatsPerRow }} total seats
          </span>
        </div>
      </div>

      <!-- Ticket types in this section -->
      <div class="ticket-types">
        <div *ngFor="let rowConfig of getRowConfigVisual(selectedSection)" class="ticket-type-item">
          <div class="type-color" [style.background-color]="rowConfig.color"></div>
          <div class="type-details">
            <span class="type-name">{{ rowConfig.ticketType }}</span>
            <span class="type-rows">{{ rowConfig.rows }} rows ({{ rowConfig.rows * selectedSection.seatsPerRow }}
              seats)</span>
          </div>
          <div class="type-price">
            {{ rowConfig.price > 0 ? (rowConfig.price | currencyFormat) : 'Price Varies' }}
          </div>
        </div>
      </div>

      <!-- Price summary -->
      <div class="price-summary" *ngIf="getSectionPriceRange(selectedSection).min > 0">
        <div class="price-range">
          <span class="price-label">Price Range:</span>
          <span class="price-value">
            {{ (getSectionPriceRange(selectedSection).min) | currencyFormat }} -
            {{ (getSectionPriceRange(selectedSection).max) | currencyFormat }}
          </span>
        </div>
      </div>
    </div>

    <div class="action-buttons">
      <button class="btn-back" (click)="selectedSection = null">
        Back
      </button>
      <button class="btn-select" (click)="navigateToSection(selectedSection)">
        View Seats
      </button>
    </div>
  </div>

  <!-- Quick Legend -->
  <!-- <div class="quick-legend">
  <div class="legend-title">Ticket Types</div>
  <div class="legend-items">
    <div *ngFor="let type of ['VIP', 'DIAMOND', 'GOLD', 'SILVER']"
         class="legend-item">
      <div class="legend-color" [style.background-color]="getColorForType(type)"></div>
      <span class="legend-text">{{ type }}</span>
    </div>
  </div>
</div> -->

</div>